# iFlow CLI 命令记录

## 一、在页面上创建处理流式服务的tab

帮我实现一个功能，我需要在index的上面额外开发一个Tab页，这个Tab里面包含 如下几个功能：
1. 增加几个按钮：选择组内的一台在线设备，一个确认按钮，点击确认按钮后会将这个设备的实时视频流实时的传递给后台服务。
2. 后台服务接收这个视频流会进行实时处理，实时返回一些处理的信息，需要写好接收后端流式的返回信息并进行展示。
3. 后台服务是一个python服务，暂时不用考虑实现这个服务

## 二、后端架构讨论

接下来，我需要开发python后端服务，目前的工程是前端服务的架构，你推荐我是单独建立后端服务，还是在这个工程下继续
按照你的建议修改
将前端页面的工程也全部存储到一个新建的前端frontend目录下吧

## 三、命令记录方式调整

将我的输入写入，而不是你的执行命令
好了，现在整理一下commands.md的格式

## 四、创建后端服务框架
 @backend/doc/外勤作业智能分析系统文档.docx.这个是后端服务接受到实时数据流后的处理逻辑整体处理流程
### 4.1需要你做的事情：
1. 创建一个workSpace，每个任务来临时在workSpace下面创建一个文件夹存储临时数据，文件夹名称为{设备编码}_{时间戳}
2. 对传递来的视频流进行处理，将视频流同步存储到本地，同时实时抽取出音频流，调用百炼的接口对音频流解析提取出文字，接口demo：@backend/demo/bailianParaformer.py,这个是调用百联平台进行语音提取的工作
3. 当语音中包含[“车号确认”、“铁鞋设置手闸拧紧、“铁鞋撤除手闸松开”]或者类似文本时，根据命中哪些文本分别进行下面的操作
4. 当某一帧音频识别出的文本包含“车号确认”或者近似的文本，根据这个语音时间点提取前面2s后面4s，每1s抽取一帧作为图像，存储到临时文件夹中，用这个图片调用阿里云视觉大模型提取车辆编号。接口demo：@backend/demo/bailianQwen3vl.py，任意一帧识别到车辆编号判断为成功，返回“识别车号：XXX”，均未识别到判断为失败，返回“未识别车号”
5. 当某一帧音频识别出的文本包含“铁鞋设置手闸拧紧”或者近似的文本，根据这个语音时间点提取前面2s后面4s，每1s抽取一帧作为图像，调用本地模型A进行判断[接口暂时预留]，任意一帧调用模型判断为成功，认为是成功，返回“防遛确认”，均未识别到判断为失败，返回“防遛未确认”
6. 当某一帧音频识别出的文本包含“铁鞋撤除手闸松开”或者近似的文本，根据这个语音时间点提取前面2s后面4s，每1s抽取一帧作为图像，调用本地模型B进行判断[接口暂时预留]，任意一帧调用模型判断为成功，认为是成功，返回“撤遛确认”，均未识别到判断为失败，返回“撤遛未确认”
7. 当命中3、4、5操作时，将判断结果和对应的几帧图像传递回前端预留的展示部分
### 4.2注意点：
1. 调用本地模型时间可能会超出1s，采用并行调用的方式，同时并行的数量需要可配置
2. 创建一个模型调用的基类，所有的模型都派生字这个基类
3. 有一个比较困难的点，抽帧进行模型判断的时间段是语音片段的时间点，而不是语音识别接口返回的时间点
 